{{- if .Values.rbac.enabled }}
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    {{- include "cpro-grafana.app.labels-v3" . | nindent 4 }}
    {{- include "cpro-grafana.labelsOrAnnotations" (tuple .Values.global.labels) | indent 4}}
  annotations:
{{- include "cpro-grafana.labelsOrAnnotations" (tuple .Values.global.annotations) | indent 4}}
  name: {{ template "cpro-grafana.serviceAccountName" . }}
automountServiceAccountToken: false
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    {{- include "cpro-grafana.app.labels-v3" . | nindent 4 }}
    {{- include "cpro-grafana.labelsOrAnnotations" (tuple .Values.global.labels) | indent 4}}
  name: {{ template "cpro-grafana.postDeleteJobResourceName" . }}
  annotations:
    {{- include "cpro-grafana.labelsOrAnnotations" (tuple .Values.global.annotations) | indent 4}}
    "helm.sh/hook": post-delete
    "helm.sh/hook-weight": "{{ .Values.helmDeleteImage.hookWeight }}"
    "helm.sh/hook-delete-policy": hook-succeeded, before-hook-creation
automountServiceAccountToken: false
{{- if and ( .Values.cmdb.enabled ) ( .Values.sqlitetomdb ) }}
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ template "cpro-grafana.postUpgradejobResourceName" . }}
  labels:
    {{- include "cpro-grafana.app.labels-v3" . | nindent 4 }}
    {{- include "cpro-grafana.labelsOrAnnotations" (tuple .Values.global.labels) | indent 4}}
  annotations:
    {{- include "cpro-grafana.labelsOrAnnotations" (tuple .Values.global.annotations) | indent 4}}
    "helm.sh/hook": post-upgrade
    "helm.sh/hook-weight": "{{ .Values.helmDeleteImage.hookWeight }}"
    "helm.sh/hook-delete-policy": hook-succeeded, before-hook-creation
{{- end }}
automountServiceAccountToken: false
{{- end }}

