{{ if .Values.geoRedundancy.enabled }}
kind: Service
apiVersion: v1
metadata:
  name: {{ template "ckey.fullName" . }}-infinispan
  labels:
    app: {{ template "ckey.chartName" . }}
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
    {{- include "ckey.customLabels" (tuple .Values.global.labels ) | indent 4 }}
    {{ include "ckey.commonLabels" . | indent 4 }}
  annotations:
    {{- include "ckey.customAnnotations" (tuple .Values.global.annotations) | indent 4 }}
spec:
  ports:
    - protocol: TCP
      port: {{ .Values.geoRedundancy.service.jgroupsTCPPort }}
      targetPort: {{ .Values.geoRedundancy.service.jgroupsTCPPort }}
      nodePort: {{ .Values.geoRedundancy.service.jgroupsExternalTCPPort }}
  {{- include "ckey.dualStack.ipFamilyPolicy.config" ( dict "root" . "context" .Values )  | indent 2 }}
  {{- include "ckey.dualStack.ipFamilies.config" ( dict "root" . "context" .Values )| indent 2 }}
  selector:
    app: {{ template "ckey.chartName" . }}
  type: NodePort
  sessionAffinity: None
  externalTrafficPolicy: Cluster
{{ end }}
