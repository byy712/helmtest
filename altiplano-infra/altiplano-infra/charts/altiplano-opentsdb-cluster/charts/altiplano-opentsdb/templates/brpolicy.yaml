{{- if not .Values.global.clustered_opentsdb }}
{{- if .Values.cbur.enabled }}
apiVersion: {{ .Values.cbur.apiVersion }}
kind: BrPolicy
metadata:
  name: {{ include "altiplano-opentsdb.fullname" . }}
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: {{ include "altiplano-opentsdb.name" . }}
  autoEnableCron: {{ .Values.cbur.autoEnableCron }}
  autoUpdateCron: {{ .Values.cbur.autoUpdateCron }}
  volumes:
    - backup
  backend:
    mode: "{{ .Values.cbur.backendMode }}"
  cronSpec: "{{ .Values.cbur.cronSpec }}"
  dataEncryption:
      enable: {{ .Values.cbur.dataEncryption }}
  k8sType: deployment
  brOption: {{ .Values.cbur.brOption }}
  maxiCopy: {{ .Values.cbur.maxiCopy}}
  ignoreFileChanged: true
  hooks:
    - name: {{ .Chart.Name }}
      commands:
        preBackupCmd: ["sh", "-c", "/opt/hbase/cbur-prebackup.sh"]
        postBackupCmd: ["sh", "-c", "echo hbase-post-backup"]
        preRestoreCmd: ["sh", "-c", "/opt/hbase/cbur-prerestore.sh"]
        postRestoreCmd: ["sh", "-c", "/opt/hbase/cbur-postrestore.sh"]
{{- end }}
{{- end }}