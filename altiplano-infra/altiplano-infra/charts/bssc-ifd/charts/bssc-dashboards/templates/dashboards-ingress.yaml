{{- if .Values.ingress.enabled }}
---
{{- $ingressControllerType := .Values.global.INGRESS_CONTROLLER_TYPE }}
{{- $url := .Values.dbobaseurl.url }}
{{- $cg := "" }}
{{- if eq ($ingressControllerType | toString) "nginxinc"}}
  {{ $cg = "" }}
{{- else }}
  {{- $cg = .Values.dbobaseurl.cg }}
{{- end }}
apiVersion: {{ template "bssc-dashboards.apiVersionNetworkingK8sIoV1orNetworkingK8sIoV1Beta1" . }}
kind: Ingress
metadata:
  annotations:
{{- include "bssc-dashboards.csf-toolkit-helm.annotations" (tuple .) | nindent 4 }}
{{- if eq ($ingressControllerType | toString) "nginxinc" }}
{{- with .Values.nginxIncIngress.annotations }}
{{ toYaml . | indent 4 }}
{{- end }}
{{- else }}
{{- with .Values.ingress.annotations }}
{{ toYaml . | indent 4 }}
{{- end }}
{{- end }}
  {{- if .Values.ingress.name }}
  name: {{ .Values.ingress.name }}
  {{- else }}
  name: "{{ printf "%s.%s.%.0f" .Release.Namespace .Release.Name .Values.dashboards.port}}"
  {{- end }}
  namespace: {{ .Release.Namespace }}
  labels:
{{- include "bssc-dashboards.commonLabels" (tuple .  "dashboards" ) | indent 4 }}
{{- include "bssc-dashboards.csf-toolkit-helm.labels" (tuple .) | nindent 4 }}

spec:
{{- if .Values.ingress.tls }}
 tls:
{{ tpl (toYaml .Values.ingress.tls) . | indent 4 }}
{{- end }}
 rules:
 - http:
     paths:
     - backend:
     {{- if eq (include "bssc-dashboards.hasIngressV1" .) "true" }}
     ### networking.k8s.io/v1
          service:
            {{- if .Values.service.name }}
            name: {{ .Values.service.name }}
            {{- else }}
            name: {{ template "bssc-dashboards.fullname" . }}
            {{- end }}
            port:
              number: {{ .Values.dashboards.port }}
       path: {{ .Values.dbobaseurl.url }}{{ .Values.dbobaseurl.cg }}
       pathType: {{ .Values.ingress.pathType }}
     {{- else }}
     ### networking.k8s.io/v1beta1
         {{- if .Values.service.name }}
         serviceName: {{ .Values.service.name }}
         {{- else }}
         serviceName: {{ template "bssc-dashboards.fullname" . }}
         {{- end }}
         servicePort: {{ .Values.dashboards.port }}
       path: {{ .Values.dbobaseurl.url }}{{ .Values.dbobaseurl.cg }}
     {{- end }}
   {{- if .Values.ingress.host }}
   host: {{ .Values.ingress.host }}
   {{- end }}
{{- end }}
