# extn/valuesModelExtnNF.yaml should be installed on top of valuesModelF.yaml

altiplano-mariadb:
   mariadb:
     ## Resource QOS (per MariaDB container)
     resources:
       requests:
         memory: 10Gi
         cpu: 5
       limits:
         memory: 28Gi
         cpu: 8    ## A customized mysqld.conf to import
         ephemeral-storage: 10Gi
     ## metrics
     metrics:
       resources:
         requests:
           memory: 256Mi
           cpu: 250m
         limits:
           memory: 256Mi
           cpu: 250m
          
     mysqld_site_conf: |-
       [mysqld]
       version = 24.6.1-REL_256-altiplano-infra-MariaDB
       skip-host-cache
       skip-name-resolve
       datadir		= /mariadb/data
       lc_messages_dir	= /usr/share/mysql
       lc_messages	= en_US
       skip-external-locking
       #
       # * Fine Tuning
       #
       max_connections		= 2000
       connect_timeout		= 5
       wait_timeout		= 1800
       max_allowed_packet	= 100M
       thread_cache_size        = 200
       sort_buffer_size	= 4M
       bulk_insert_buffer_size	= 16M
       tmp_table_size		= 32M
       max_heap_table_size	= 32M
       #
       # * MyISAM
       #
       # This replaces the startup script and checks MyISAM tables if needed
       # the first time they are touched. On error, make copy and try a repair.
       myisam_recover_options = BACKUP
       key_buffer_size		= 128M
       #open-files-limit	= 2000
       table_open_cache	= 400
       myisam_sort_buffer_size	= 512M
       concurrent_insert	= 2
       read_buffer_size	= 2M
       read_rnd_buffer_size	= 1M
       #
       # * Query Cache Configuration
       #
       # Cache only tiny result sets, so we can fit more in the query cache.
       query_cache_limit		= 128K
       query_cache_size		= 0
       # for more write intensive setups, set to DEMAND or OFF
       query_cache_type		= OFF
       #
       # * Logging and Replication
       #
       # Both location gets rotated by the cronjob.
       # Be aware that this log type is a performance killer.
       # As of 5.1 you can enable the log at runtime!
       #general_log_file        = /var/log/mysql/mysql.log
       #general_log             = 1
       #
       # Error logging goes to syslog due to /etc/mysql/conf.d/mysqld_safe_syslog.cnf.
       #
       # we do want to know about network errors and such
       #log_warnings		= 2
       #
       # Enable the slow query log to see queries with especially long duration
       #slow_query_log[={0|1}]
       slow_query_log_file	= /var/log/mysql/mariadb-slow.log
       long_query_time = 10
       #log_slow_rate_limit	= 1000
       #log_slow_verbosity	= query_plan

       #log-queries-not-using-indexes
       #log_slow_admin_statements
       #
       # The following can be used as easy to replay backup logs or for replication.
       # note: if you are setting up a replication slave, see README.Debian about
       #       other settings you may need to change.
       #server-id		= 1
       #report_host		= master1
       #auto_increment_increment = 2
       #auto_increment_offset	= 1
       #log_bin			= /var/log/mysql/mariadb-bin
       #log_bin_index		= /var/log/mysql/mariadb-bin.index
       # not fab for performance, but safer
       #sync_binlog		= 1
       expire_logs_days	= 1
       max_binlog_size         = 100M
       # slaves
       #relay_log		= /var/log/mysql/relay-bin
       #relay_log_index	= /var/log/mysql/relay-bin.index
       #relay_log_info_file	= /var/log/mysql/relay-bin.info
       #log_slave_updates
       #read_only
       #
       # If applications support it, this stricter sql_mode prevents some
       # mistakes like inserting invalid dates etc.
       #sql_mode		= NO_ENGINE_SUBSTITUTION,TRADITIONAL
       #
       # * InnoDB
       #
       # InnoDB is enabled by default with a 10MB datafile in /var/lib/mysql/.
       # Read the manual for more InnoDB related options. There are many!
       default_storage_engine	= InnoDB
       # you can't just change log file size, requires special procedure
       #innodb_log_file_size	= 50M
       innodb_buffer_pool_size	= 16384M
       innodb_log_buffer_size	= 8M
       innodb_file_per_table	= 1
       innodb_open_files	= 400
       innodb_io_capacity	= 400
       innodb_flush_method	= O_DIRECT
       innodb_buffer_pool_instances	= 8
       innodb_read_only_compressed = OFF
       tls_version = TLSv1.2,TLSv1.3

altiplano-pts:
  pushgateway:
    resources:
      limits:
        cpu: 3
        ephemeral-storage: 1G
        memory: 3Gi
      requests:
        cpu: 500m
        ephemeral-storage: 1G
        memory: 128Mi

altiplano-kafka:
  resources:
    requests:
      cpu: 0.66
      memory: 5500Mi
    limits:
      cpu: 2
      memory: 7Gi

altiplano-opentsdb-cluster:
  altiplano-opentsdb:
    env:
      init:
        TSD_UID_LRU_ID_SIZE: "10000000"
        TSD_UID_LRU_NAME_SIZE: "70000000"
        TSDB_TTL: "86400"
      open:
        JVMARGS: "-XX:+UseG1GC -Xms30G -Xmx30G -XX:MaxGCPauseMillis=1000 -XX:ActiveProcessorCount=6 -XX:ConcGCThreads=4 --add-opens java.base/java.nio=ALL-UNNAMED --add-opens java.security.jgss/sun.security.krb5=ALL-UNNAMED"
    resources:
      requests:
        cpu: 2
        memory: 30Gi
      limits:
        cpu: 6
        memory: 40Gi

  altiplano-hbase:
    hbase:
      regionServer:
        replicas: 5

altiplano-installation-info:
  installationStatus:
    valuesModelExtnNF: installed
