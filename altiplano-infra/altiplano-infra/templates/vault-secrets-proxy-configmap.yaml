{{- if .Values.global.vault.enabled }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "altiplano-infra.app" . }}-secrets-proxy-json-profile
  labels:
    {{- include "altiplano-infra.labels" $ | nindent 4 }}
    app: {{ template "altiplano-infra.app" . }}-secrets-proxy-json-profile
    release: {{ .Release.Name }}
  annotations:
    "helm.sh/hook": pre-upgrade, pre-install
    "helm.sh/hook-weight": "-10"
    # hhok-failed is not working so using before-hook-creation
    "helm.sh/hook-delete-policy": before-hook-creation
    #"helm.sh/hook-delete-policy": before-hook-creation, hook-succeeded
data:
  {{ tpl (.Files.Glob "secrets-proxy-config/*").AsConfig . | nindent 2 }}
---
{{- end }}